(()=>{"use strict";var t={56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function n(t){for(var n=-1,o=0;o<e.length;o++)if(e[o].identifier===t){n=o;break}return n}function o(t,o){for(var s={},a=[],i=0;i<t.length;i++){var l=t[i],c=o.base?l[0]+o.base:l[0],d=s[c]||0,p="".concat(c," ").concat(d);s[c]=d+1;var u=n(p),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)e[u].references++,e[u].updater(f);else{var g=r(f,o);o.byIndex=i,e.splice(i,0,{identifier:p,updater:g,references:1})}a.push(p)}return a}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var s=o(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<s.length;a++){var i=n(s[a]);e[i].references--}for(var l=o(t,r),c=0;c<s.length;c++){var d=n(s[c]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}s=l}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},208:(t,e,n)=>{n.d(e,{A:()=>i});var o=n(601),r=n.n(o),s=n(314),a=n.n(s)()(r());a.push([t.id,"body {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    font-family: sans-serif;\n    margin: 0;\n    background-color: #333;\n}\n\n.controls {\n    width: 800px;\n    margin-bottom: 20px;\n    padding: 10px;\n    text-align: right;\n}\n\n.controls button {\n    margin-left: 10px;\n}\n\n.buffer-zone,\n.working-zone {\n    width: 800px;\n    height: 300px;\n    border: 1px solid #777;\n    margin-bottom: 20px;\n    overflow: hidden;\n    position: relative;\n}\n\n.buffer-zone {\n    background-color: #444;\n}\n\n.working-zone {\n    background-color: #444;\n    background-image:\n        linear-gradient(to right, #555 1px, transparent 1px),\n        linear-gradient(to bottom, #555 1px, transparent 1px);\n    background-size: 20px 20px;\n    position: relative;\n}\n\n.working-zone-content {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    transform-origin: 0 0;\n}\n\n.coord-scale-x,\n.coord-scale-y {\n    position: absolute;\n    color: #bbb;\n    font-size: 10px;\n    pointer-events: none;\n    z-index: 1;\n}\n\n.coord-scale-x {\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    display: flex;\n    justify-content: space-between;\n    padding: 0 5px;\n}\n\n.coord-scale-y {\n    top: 0;\n    left: 30px;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    padding: 5px 0;\n    text-align: right;\n}\n\nsvg-polygon::shadow polygon {\n    fill: #c0392b;\n} ",""]);const i=a},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",o=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),o&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),o&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,o,r,s){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(o)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(a[l]=!0)}for(var c=0;c<t.length;c++){var d=[].concat(t[c]);o&&a[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),e.push(d))}},e}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,n){var o=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var s=e[o]={id:o,exports:{}};return t[o](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;var o=n(72),r=n.n(o),s=n(825),a=n.n(s),i=n(659),l=n.n(i),c=n(56),d=n.n(c),p=n(540),u=n.n(p),f=n(113),g=n.n(f),h=n(208),m={};m.styleTagTransform=g(),m.setAttributes=d(),m.insert=l().bind(null,"head"),m.domAPI=a(),m.insertStyleElement=u(),r()(h.A,m),h.A&&h.A.locals&&h.A.locals;class y extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).innerHTML='\n            <style>\n                :host {\n                    display: block;\n                    cursor: grab;\n                    position: absolute; /* Make polygons positionable */\n                    /* Set initial size for drag calculations */\n                    width: 100px;\n                    height: 100px;\n                }\n                svg {\n                    width: 100%;\n                    height: 100%;\n                }\n            </style>\n            <svg viewBox="0 0 100 100"></svg>\n        ',this.isDragging=!1,this.offsetX=0,this.offsetY=0,this.addEventListener("mousedown",this.onMouseDown.bind(this))}set points(t){const e=this.shadowRoot.querySelector("svg");let n=e.querySelector("polygon");n||(n=document.createElementNS("http://www.w3.org/2000/svg","polygon"),e.appendChild(n)),n.setAttribute("points",t),n.setAttribute("fill","red")}onMouseDown(t){this.parentElement===E&&(this.isDragging=!0,this.offsetX=t.clientX-this.getBoundingClientRect().left,this.offsetY=t.clientY-this.getBoundingClientRect().top,this.style.cursor="grabbing",t.stopPropagation())}setPosition(t,e){this.style.position="absolute",this.style.left=`${t}px`,this.style.top=`${e}px`}}customElements.define("svg-polygon",y);const v=document.getElementById("create-btn"),x=document.getElementById("save-btn"),b=document.getElementById("reset-btn"),w=document.getElementById("reset-zoom-btn"),A=document.querySelector(".buffer-zone"),S=document.querySelector(".working-zone"),E=document.querySelector(".working-zone-content"),M=document.querySelector(".coord-scale-x"),C=document.querySelector(".coord-scale-y");let L=1,k=0,z=0,I=!1,O=0,T=0;function B(){E.style.transform=`translate(${k}px, ${z}px) scale(${L})`,S.style.backgroundSize=`${20*L}px ${20*L}px`,function(){M.innerHTML="",C.innerHTML="";const t=S.getBoundingClientRect();let e=100;L<.5&&(e=200),L<.2&&(e=500),L>1.5&&(e=50),L>3&&(e=20),L>6&&(e=10);const n=-k/L,o=-z/L,r=n+t.width/L,s=o+t.height/L;for(let o=Math.floor(n/e)*e;o<r;o+=e){const e=o*L+k;if(e>=0&&e<=t.width){const t=document.createElement("span");t.textContent=Math.round(o),t.style.position="absolute",t.style.left=`${e}px`,t.style.transform="translateX(-50%)",t.style.bottom="5px",M.appendChild(t)}}for(let n=Math.floor(o/e)*e;n<s;n+=e){const e=n*L+z;if(e>=0&&e<=t.height){const t=document.createElement("span");t.textContent=Math.round(n),t.style.position="absolute",t.style.top=`${e}px`,t.style.transform="translateY(-50%)",t.style.right="5px",C.appendChild(t)}}}(),function(){const t=document.querySelector(".zoom-scale")||document.createElement("div");document.querySelector(".zoom-scale")||(t.className="zoom-scale",t.style.position="absolute",t.style.top="10px",t.style.left="40px",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.color="white",t.style.padding="5px 10px",t.style.borderRadius="3px",t.style.fontSize="12px",S.appendChild(t)),t.textContent=`Масштаб: ${Math.round(100*L)}%`}()}function D(t){const e=[],n=[];for(let e=0;e<t;e++){const o=2*e*Math.PI/t+(.5*Math.random()-.25),r=20+20*Math.random();n.push({angle:o,radius:r})}n.sort(((t,e)=>t.angle-e.angle));for(const t of n){const n=50+t.radius*Math.cos(t.angle),o=50+t.radius*Math.sin(t.angle);e.push(`${n},${o}`)}return e.join(" ")}v.addEventListener("click",(()=>{const t=Math.floor(16*Math.random())+5;A.innerHTML="";for(let e=0;e<t;e++){const t=D(Math.floor(5*Math.random())+3),e=new y;e.points=t;const n=A.clientWidth,o=A.clientHeight,r=100,s=Math.random()*(n-r),a=Math.random()*(o-r);e.style.position="absolute",e.style.left=`${s}px`,e.style.top=`${a}px`,e.style.width=`${r}px`,e.style.height=`${r}px`,e.setAttribute("draggable",!0),A.appendChild(e)}}));let Y=null;document.addEventListener("dragstart",(t=>{if("SVG-POLYGON"===t.target.tagName){Y=t.target;const e=Y.getBoundingClientRect();Y.dragOffsetX=t.clientX-e.left,Y.dragOffsetY=t.clientY-e.top;const n=new Image;n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",t.dataTransfer.setDragImage(n,0,0),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain","")}})),document.addEventListener("dragover",(t=>{t.preventDefault(),(t.target===A||t.target===E||t.target.closest(".buffer-zone")||t.target.closest(".working-zone-content"))&&(t.dataTransfer.dropEffect="move")})),document.addEventListener("drop",(t=>{if(t.preventDefault(),Y){const e=t.target.closest(".buffer-zone")||t.target.closest(".working-zone-content");if(e)if(e===E){const n=t.clientX,o=t.clientY,r=S.getBoundingClientRect(),s=n-r.left,a=o-r.top,i=(s-k)/L,l=(a-z)/L,c=Y.dragOffsetX/L,d=Y.dragOffsetY/L;Y.style.position="absolute",Y.style.left=i-c+"px",Y.style.top=l-d+"px",e.appendChild(Y),Y.style.transform="none",Y.style.transformOrigin="0 0"}else{const n=e.getBoundingClientRect(),o=t.clientX-n.left,r=t.clientY-n.top;Y.style.position="absolute",Y.style.left=o-Y.dragOffsetX+"px",Y.style.top=r-Y.dragOffsetY+"px",e.appendChild(Y)}Y=null}})),document.addEventListener("dragstart",(t=>{"IMG"===t.target.tagName&&t.preventDefault()})),S.addEventListener("wheel",(t=>{t.preventDefault();const e=t.deltaY>0?.9:1.1,n=L*e;if(n>.1&&n<10){const e=S.getBoundingClientRect(),o=t.clientX-e.left,r=t.clientY-e.top;k=o-n/L*(o-k),z=r-n/L*(r-z),L=n,B()}})),S.addEventListener("mousedown",(t=>{0!==t.button||t.target.closest("svg-polygon")||(I=!0,O=t.clientX,T=t.clientY,S.style.cursor="grabbing",t.preventDefault())})),document.addEventListener("mousemove",(t=>{if(I){const e=t.clientX-O,n=t.clientY-T;k+=e,z+=n,O=t.clientX,T=t.clientY,B(),t.preventDefault()}})),document.addEventListener("mouseup",(t=>{I&&(I=!1,S.style.cursor="default",t.preventDefault())})),x.addEventListener("click",(function(){const t=[];E.querySelectorAll("svg-polygon").forEach((e=>{const n=e.shadowRoot.querySelector("svg").querySelector("polygon"),o=n?n.getAttribute("points"):"";t.push({points:o,left:e.style.left,top:e.style.top,width:e.style.width,height:e.style.height})})),localStorage.setItem("savedPolygons",JSON.stringify(t)),localStorage.setItem("currentZoom",L.toString()),localStorage.setItem("panOffset",JSON.stringify({x:k,y:z})),console.log("Polygons saved to localStorage.")})),b.addEventListener("click",(function(){localStorage.removeItem("savedPolygons"),E.innerHTML="",console.log("Polygons reset.")})),w.addEventListener("click",(function(){L=1,k=0,z=0,B()})),window.addEventListener("load",(()=>{!function(){const t=localStorage.getItem("savedPolygons"),e=localStorage.getItem("currentZoom"),n=localStorage.getItem("panOffset");if(e&&(L=parseFloat(e)),n){const{x:t,y:e}=JSON.parse(n);k=t,z=e}if(t){const e=JSON.parse(t);E.innerHTML="",e.forEach((t=>{const e=new y;e.points=t.points,e.style.position="absolute",e.style.left=t.left,e.style.top=t.top,e.style.width=t.width,e.style.height=t.height,e.setAttribute("draggable",!0),E.appendChild(e)})),console.log("Polygons loaded from localStorage.")}B()}(),B()}))})();
